<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brawl Nest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ff8c00, #ffa500, #ff7f00);
            color: #333;
            min-height: 100vh;
        }

        /* Layout principal */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Notification popup */
        .notification-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-left: 4px solid #ff6600;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 2000;
            max-width: 350px;
            backdrop-filter: blur(10px);
        }

        .notification-popup.show {
            transform: translateX(0);
        }

        .notification-title {
            font-weight: bold;
            color: #ff6600;
            margin-bottom: 5px;
        }

        .notification-content {
            color: #666;
            font-size: 0.9em;
        }

        .notification-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 18px;
            color: #999;
            cursor: pointer;
        }

        /* Notification permission banner */
        .notification-banner {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ff6600;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .notification-banner.show {
            display: block;
        }

        .notification-banner h3 {
            color: #ff6600;
            margin-bottom: 10px;
        }

        .notification-banner p {
            margin-bottom: 15px;
            color: #666;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-right: 2px solid rgba(255, 255, 255, 0.2);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }

        .logo-section {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin: 0 auto 15px;
        }

        .logo-text {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-menu {
            list-style: none;
            padding: 0 20px;
        }

        .nav-menu li {
            margin-bottom: 5px;
        }

        .nav-menu a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .notification-badge {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff0000;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Mobile sidebar toggle */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            z-index: 1001;
            backdrop-filter: blur(10px);
        }

        /* Zone de contenu principal */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 40px;
            transition: margin-left 0.3s ease;
        }

        .main-content.mobile-full {
            margin-left: 0;
            padding: 80px 20px 20px;
        }

        /* Bouton retour */
        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            display: none;
            backdrop-filter: blur(10px);
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .back-button.show {
            display: inline-block;
        }

        /* Sections de contenu */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 2.5em;
            color: #ff6600;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Accueil */
        .welcome-banner {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 40px;
        }

        .welcome-banner h1 {
            font-size: 3.5em;
            color: #ff6600;
            margin-bottom: 15px;
        }

        .welcome-banner p {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 30px;
        }

        .cta-button {
            background: linear-gradient(45deg, #ff6600, #ff8c00);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 102, 0, 0.3);
        }

        /* Grille de stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            color: #ff6600;
        }

        .stat-label {
            font-size: 1.1em;
            color: #666;
            margin-top: 10px;
        }

        /* Événements et News */
        .events-container, .news-container {
            display: grid;
            gap: 20px;
        }

        .event-card, .news-item {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ffa500;
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }

        .news-item {
            border-left: 4px solid #ff6600;
            border-radius: 0 10px 10px 0;
        }

        .event-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-ongoing {
            background: #4CAF50;
            color: white;
        }

        .status-upcoming {
            background: #ff9800;
            color: white;
        }

        .status-finished {
            background: #999;
            color: white;
        }

        .event-title, .news-title {
            font-size: 1.5em;
            color: #ff6600;
            margin-bottom: 10px;
        }

        .event-description, .news-content {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .event-date, .news-date {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .event-timer {
            font-weight: bold;
            color: #ff6600;
            margin-top: 10px;
        }

        .no-content {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        /* Panel Admin */
        .admin-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #dc3545;
            border-radius: 15px;
            padding: 30px;
        }

        .admin-login {
            text-align: center;
        }

        .admin-form {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #ff6600;
        }

        .btn {
            background: #ff6600;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #e55a00;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .admin-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .admin-item-content {
            flex: 1;
            margin-right: 15px;
        }

        .admin-item-title {
            font-weight: bold;
            color: #ff6600;
            margin-bottom: 5px;
        }

        .admin-item-meta {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .admin-item-desc {
            font-size: 0.9em;
            color: #333;
        }

        .admin-item-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .error {
            color: #dc3545;
            margin-top: 10px;
        }

        .no-items {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 20px;
        }

        .admin-controls {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        /* Mobile responsif */
        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 80px 20px 20px;
            }

            .welcome-banner h1 {
                font-size: 2.5em;
            }

            .welcome-banner {
                padding: 30px 20px;
            }

            .section-card {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .admin-panel {
                padding: 20px;
            }

            .notification-popup {
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-100px);
            }

            .notification-popup.show {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Popup de notification -->
        <div class="notification-popup" id="notificationPopup">
            <button class="notification-close" onclick="hideNotification()">×</button>
            <div class="notification-title" id="notificationTitle"></div>
            <div class="notification-content" id="notificationContent"></div>
        </div>

        <!-- Bouton toggle mobile -->
        <button class="mobile-toggle" onclick="toggleSidebar()">☰</button>

        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="logo-section">
                <div class="logo-icon">🐦</div>
                <div class="logo-text">Brawl Nest</div>
            </div>
            <ul class="nav-menu">
                <li><a href="#home" onclick="showSection('home'); clearBadge('nav-home')" class="active" id="nav-home">🏠 Home</a></li>
                <li><a href="#events" onclick="showSection('events'); clearBadge('nav-events')" id="nav-events">🎮 Events <span class="notification-badge" id="badge-events" style="display: none;">0</span></a></li>
                <li><a href="#news" onclick="showSection('news'); clearBadge('nav-news')" id="nav-news">📰 News <span class="notification-badge" id="badge-news" style="display: none;">0</span></a></li>
                <li><a href="#discord" onclick="showSection('discord')" id="nav-discord">💬 Discord</a></li>
                <li><a href="#panel" onclick="showSection('admin')" id="nav-admin">⚙️ Admin</a></li>
            </ul>
        </nav>

        <!-- Contenu principal -->
        <main class="main-content" id="mainContent">
            <!-- Banner de permission de notification -->
            <div class="notification-banner" id="notificationBanner">
                <h3>🔔 Recevoir des notifications</h3>
                <button class="btn" onclick="requestNotificationPermission()">Activer</button>
                <button class="btn btn-secondary" onclick="hideNotificationBanner()">Plus tard</button>
            </div>

            <!-- Bouton retour -->
            <button class="back-button" id="backButton" onclick="goBack()">← Retour à l'accueil</button>

            <!-- Section Accueil -->
            <div id="home" class="content-section active">
                <div class="welcome-banner">
                    <h1>Bienvenue sur Brawl Nest</h1>
                    <p>Le serveur Discord gaming communautaire Brawl stars !</p>
                    <a href="#invitediscord" onclick="showSection('discord')" class="cta-button">Rejoindre le Discord</a>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="memberCount">0</div>
                        <div class="stat-label">Membres</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="onlineCount">0</div>
                        <div class="stat-label">En ligne</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="eventCount">0</div>
                        <div class="stat-label">Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="newsCount">0</div>
                        <div class="stat-label">News</div>
                    </div>
                </div>
            </div>

            <!-- Section Événements -->
            <div id="events" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">🎮 Events</h2>
                    <div class="events-container" id="eventsContainer">
                        <div class="no-content">
                            <p>Aucun événement pour le moment.<br>Revenez plus tard ou contactez les administrateurs !</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section News -->
            <div id="news" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">📰 News</h2>
                    <div class="news-container" id="newsContainer">
                        <div class="no-content">
                            <p>Aucune news pour le moment.<br>Restez connectés pour les dernières actualités !</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Discord -->
            <div id="discord" class="content-section">
                <div class="section-card">
                    <h2 class="section-title">💬 Rejoindre le Discord</h2>
                    <div style="text-align: center;">
                        <p style="font-size: 1.2em; margin-bottom: 30px;">
                            Rejoignez notre communauté Discord pour participer aux événements, 
                            discuter avec d'autres personnes et rester au courant des dernières news !
                        </p>
                        <button class="cta-button" onclick="joinDiscord()">
                            🎮 Rejoindre le serveur Discord
                        </button>
                    </div>
                </div>
            </div>

            <!-- Section Admin -->
            <div id="admin" class="content-section">
                <div class="admin-panel">
                    <h2 class="section-title">⚙️ Panel Administrateur</h2>
                    
                    <div class="admin-login" id="adminLogin">
                        <div class="form-group">
                            <input type="password" id="adminCode" placeholder="Code d'accès administrateur">
                        </div>
                        <button class="btn" onclick="adminLogin()">Se connecter</button>
                        <div class="error" id="loginError"></div>
                    </div>

                    <div class="admin-form" id="adminForm">
                        <h3>Ajouter un événement</h3>
                        <div class="form-group">
                            <label>Titre de l'événement</label>
                            <input type="text" id="eventTitle" placeholder="Ex: Tournoi Brawl Stars">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="eventDescription" rows="3" placeholder="Description de l'événement..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Date et heure de l'événement</label>
                            <input type="datetime-local" id="eventDateTime">
                        </div>
                        <div class="form-group">
                            <label>Statut</label>
                            <select id="eventStatus">
                                <option value="upcoming">À venir</option>
                                <option value="ongoing">En cours</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Durée (en minutes)</label>
                            <input type="number" id="eventDuration" placeholder="120" min="1">
                        </div>
                        <button class="btn" onclick="addEvent()">Ajouter l'événement</button>

                        <hr style="margin: 30px 0;">

                        <h3>Gérer les événements existants</h3>
                        <div id="adminEventsList"></div>

                        <hr style="margin: 30px 0;">

                        <h3>Ajouter une news</h3>
                        <div class="form-group">
                            <label>Titre de la news</label>
                            <input type="text" id="newsTitle" placeholder="Titre de la news">
                        </div>
                        <div class="form-group">
                            <label>Contenu</label>
                            <textarea id="newsContent" rows="4" placeholder="Contenu de la news..."></textarea>
                        </div>
                        <button class="btn" onclick="addNews()">Publier la news</button>

                        <hr style="margin: 30px 0;">

                        <h3>Gérer les news existantes</h3>
                        <div id="adminNewsList"></div>

                        <hr style="margin: 30px 0;">

                        <h3>Gestion</h3>
                        <button class="btn btn-danger" onclick="clearEvents()">Effacer tous les événements</button>
                        <button class="btn btn-danger" onclick="clearNews()">Effacer toutes les news</button>
                        <button class="btn btn-secondary" onclick="adminLogout()">Déconnexion</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let currentSection = 'home';
        let isAdmin = false;
        let events = [];
        let news = [];
        let eventTimers = {};
        let notificationPermission = 'default';
        let newEventCount = 0;
        let newNewsCount = 0;
        let notificationRequested = false;

        // Système de notifications
        function checkNotificationSupport() {
            if (!("Notification" in window)) {
                console.log("Ce navigateur ne supporte pas les notifications desktop");
                return false;
            }
            return true;
        }

        function requestNotificationPermission() {
            if (!checkNotificationSupport()) {
                alert("Votre navigateur ne supporte pas les notifications");
                return;
            }

            // Marquer que la demande a été faite
            notificationRequested = true;
            // Sauvegarder dans sessionStorage pour cette session
            sessionStorage.setItem('notificationRequested', 'true');

            Notification.requestPermission().then(function (permission) {
                notificationPermission = permission;
                
                if (permission === "granted") {
                    showNotification("🔔 Notifications activées", "Vous recevrez maintenant les notifications des nouveaux événements et news !");
                    hideNotificationBanner();
                } else if (permission === "denied") {
                    hideNotificationBanner();
                    alert("Notifications refusées. Vous pouvez les réactiver dans les paramètres de votre navigateur.");
                }
            });
        }

        function showNotification(title, body, icon = null) {
            if (notificationPermission === "granted") {
                const notification = new Notification(title, {
                    body: body,
                    icon: icon || "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMzIiIGZpbGw9IiNmZjY2MDAiLz4KPHN2ZyB4PSIxNiIgeT0iMTYiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzEzLjEgMiAxNCAyLjkgMTQgNFY1LjA4TDE0LjE1IDVMMTkuODQgMTAuNjlMMjEuMjUgMTIuMUwxOS44NCAxMy41MUwxNCAyMy4yNVYyMC4wNEMxNCAyMC45IDE0LjkgMjEuOCAxNiAyMS44SDE4VjI0SDE2QzEzLjggMjQgMTIgMjIuMiAxMiAyMFYxOS45MkwxMS44NSAxOUw2LjE2IDEzLjMxTDQuNzUgMTEuOUw2LjE2IDEwLjQ5TDEyIDAuNzVWNEMxMiAyLjkgMTAuMSAyIDEwIDJaIi8+Cjwvc3ZnPgo8L3N2Zz4K",
                    tag: "brawl-nest-notification"
                });

                // Fermer la notification après 5 secondes
                setTimeout(() => {
                    notification.close();
                }, 3500);
            }

            // Afficher aussi la notification in-app
            showInAppNotification(title, body);
        }

        function showInAppNotification(title, body) {
            const popup = document.getElementById('notificationPopup');
            const titleEl = document.getElementById('notificationTitle');
            const contentEl = document.getElementById('notificationContent');
            
            titleEl.textContent = title;
            contentEl.textContent = body;
            
            popup.classList.add('show');
            
            // Auto-fermer après 5 secondes
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            const popup = document.getElementById('notificationPopup');
            popup.classList.remove('show');
        }

        function hideNotificationBanner() {
            const banner = document.getElementById('notificationBanner');
            banner.style.display = 'none';
            banner.classList.remove('show');
            
            // Marquer que l'utilisateur a interagi avec le banner
            notificationRequested = true;
            sessionStorage.setItem('notificationRequested', 'true');
        }

        function showNotificationBanner() {
            // Ne montrer le banner que si :
            // 1. Les notifications ne sont pas encore autorisées
            // 2. L'utilisateur n'a pas encore été sollicité dans cette session
            // 3. On est sur la page d'accueil
            if (notificationPermission === 'default' && !notificationRequested && currentSection === 'home') {
                const banner = document.getElementById('notificationBanner');
                banner.classList.add('show');
            }
        }

        function updateBadge(type, count) {
            const badge = document.getElementById(`badge-${type}`);
            if (count > 0) {
                badge.style.display = 'flex';
                badge.textContent = count > 99 ? '99+' : count;
            } else {
                badge.style.display = 'none';
            }
        }

        function clearBadge(navId) {
            if (navId === 'nav-events') {
                newEventCount = 0;
                updateBadge('events', 0);
            } else if (navId === 'nav-news') {
                newNewsCount = 0;
                updateBadge('news', 0);
            }
        }

        // Navigation
        function showSection(sectionName) {
            // Fermer la sidebar sur mobile
            closeSidebar();

            // Masquer toutes les sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Afficher la section demandée
            document.getElementById(sectionName).classList.add('active');

            // Mettre à jour la navbar
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.classList.remove('active');
            });
            
            const targetLink = document.getElementById(`nav-${sectionName}`);
            if (targetLink) {
                targetLink.classList.add('active');
            }

            // Afficher/masquer le bouton retour
            const backButton = document.getElementById('backButton');
            if (sectionName === 'home') {
                backButton.classList.remove('show');
            } else {
                backButton.classList.add('show');
            }

            currentSection = sectionName;

            // Masquer le banner de notifications si on quitte l'accueil
            if (sectionName !== 'home') {
                const banner = document.getElementById('notificationBanner');
                banner.classList.remove('show');
            }
        }

        function goBack() {
            showSection('home');
        }

        // Sidebar mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.remove('mobile-open');
        }

        // Admin
        function adminLogin() {
            const code = document.getElementById('adminCode').value;
            const errorDiv = document.getElementById('loginError');
            
            if (code === 'BIRD') {
                isAdmin = true;
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminForm').style.display = 'block';
                errorDiv.textContent = '';
                
                // Rafraîchir l'affichage pour montrer les boutons de suppression
                displayEvents();
                displayNews();
                updateAdminLists();
            } else {
                errorDiv.textContent = 'Code incorrect !';
            }
        }

        function adminLogout() {
            isAdmin = false;
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminForm').style.display = 'none';
            document.getElementById('adminCode').value = '';
            
            // Masquer les boutons de suppression
            displayEvents();
            displayNews();
            updateAdminLists();
        }

        // Événements
        function addEvent() {
            if (!isAdmin) return;

            const title = document.getElementById('eventTitle').value;
            const description = document.getElementById('eventDescription').value;
            const dateTime = document.getElementById('eventDateTime').value;
            const status = document.getElementById('eventStatus').value;
            const duration = parseInt(document.getElementById('eventDuration').value);

            if (!title || !description || !dateTime || !duration) {
                alert('Veuillez remplir tous les champs !');
                return;
            }

            const eventDate = new Date(dateTime);
            const event = {
                id: Date.now(),
                title: title,
                description: description,
                date: eventDate,
                status: status,
                duration: duration,
                createdAt: new Date(),
                endTime: status === 'ongoing' ? new Date(Date.now() + duration * 60000) : new Date(eventDate.getTime() + duration * 60000)
            };

            events.push(event);
            saveEvents();
            displayEvents();
            updateStats();
            updateAdminLists();

            // Réinitialiser le formulaire
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('eventDateTime').value = '';
            document.getElementById('eventDuration').value = '';

            if (status === 'ongoing') {
                startEventTimer(event);
            }

            // Envoyer notification
            newEventCount++;
            updateBadge('events', newEventCount);
            showNotification(
                "🎮 Nouvel événement !",
                `${title} - ${status === 'ongoing' ? 'En cours maintenant' : 'Programmé pour le ' + eventDate.toLocaleDateString('fr-FR')}`
            );

            alert('Événement ajouté avec succès !');
        }

        function startEventTimer(event) {
            eventTimers[event.id] = setInterval(() => {
                const now = new Date();
                const timeLeft = event.endTime - now;

                if (timeLeft <= 0) {
                    // Marquer l'événement comme terminé
                    const eventIndex = events.findIndex(e => e.id === event.id);
                    if (eventIndex !== -1) {
                        events[eventIndex].status = 'finished';
                        saveEvents();
                    }
                    
                    clearInterval(eventTimers[event.id]);
                    delete eventTimers[event.id];
                    displayEvents();
                    updateStats();
                } else {
                    const hours = Math.floor(timeLeft / 3600000);
                    const minutes = Math.floor((timeLeft % 3600000) / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    const timerElement = document.getElementById(`timer-${event.id}`);
                    if (timerElement) {
                        timerElement.textContent = `Temps restant: ${hours}h ${minutes}m ${seconds}s`;
                    }
                }
            }, 1000);
        }

        function displayEvents() {
            const container = document.getElementById('eventsContainer');
            
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="no-content">
                        <p>Aucun événement pour le moment.<br>Revenez plus tard ou contactez les administrateurs !</p>
                    </div>
                `;
                return;
            }

            // Trier les événements par date (plus récents en premier)
            const sortedEvents = [...events].sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = sortedEvents.map(event => {
                let statusClass, statusText;
                
                switch(event.status) {
                    case 'ongoing':
                        statusClass = 'status-ongoing';
                        statusText = 'En cours';
                        break;
                    case 'finished':
                        statusClass = 'status-finished';
                        statusText = 'Terminé';
                        break;
                    default:
                        statusClass = 'status-upcoming';
                        statusText = 'À venir';
                }
                
                let timerHtml = '';
                if (event.status === 'ongoing') {
                    const now = new Date();
                    const timeLeft = event.endTime - now;
                    if (timeLeft > 0) {
                        const hours = Math.floor(timeLeft / 3600000);
                        const minutes = Math.floor((timeLeft % 3600000) / 60000);
                        const seconds = Math.floor((timeLeft % 60000) / 1000);
                        timerHtml = `<div class="event-timer" id="timer-${event.id}">Temps restant: ${hours}h ${minutes}m ${seconds}s</div>`;
                        
                        // Redémarrer le timer si nécessaire
                        setTimeout(() => {
                            if (!eventTimers[event.id]) {
                                startEventTimer(event);
                            }
                        }, 100);
                    }
                }

                return `
                    <div class="event-card">
                        <div class="event-status ${statusClass}">${statusText}</div>
                        <div class="event-date">${new Date(event.date).toLocaleDateString('fr-FR')} à ${new Date(event.date).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</div>
                        <div class="event-title">${event.title}</div>
                        <div class="event-description">${event.description}</div>
                        ${timerHtml}
                        ${isAdmin ? `
                            <div class="admin-controls">
                                <button class="btn btn-danger" onclick="removeEvent(${event.id})">🗑️ Supprimer</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function removeEvent(eventId) {
            if (!isAdmin) return;
            
            if (confirm('Êtes-vous sûr de vouloir supprimer cet événement ?')) {
                events = events.filter(e => e.id !== eventId);
                if (eventTimers[eventId]) {
                    clearInterval(eventTimers[eventId]);
                    delete eventTimers[eventId];
                }
                saveEvents();
                displayEvents();
                updateStats();
                updateAdminLists();
            }
        }

        function clearEvents() {
            if (!isAdmin) return;
            
            if (confirm('Êtes-vous sûr de vouloir supprimer tous les événements ?')) {
                events = [];
                Object.keys(eventTimers).forEach(id => {
                    clearInterval(eventTimers[id]);
                });
                eventTimers = {};
                saveEvents();
                displayEvents();
                updateStats();
                updateAdminLists();
            }
        }

        // News
        function addNews() {
            if (!isAdmin) return;

            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;

            if (!title || !content) {
                alert('Veuillez remplir tous les champs !');
                return;
            }

            const newsItem = {
                id: Date.now(),
                title: title,
                content: content,
                date: new Date()
            };

            news.unshift(newsItem);
            saveNews();
            displayNews();
            updateStats();
            updateAdminLists();

            // Réinitialiser le formulaire
            document.getElementById('newsTitle').value = '';
            document.getElementById('newsContent').value = '';

            // Envoyer notification
            newNewsCount++;
            updateBadge('news', newNewsCount);
            showNotification(
                "📰 Nouvelle actualité !",
                `${title} - ${content.substring(0, 50)}${content.length > 50 ? '...' : ''}`
            );

            alert('News publiée avec succès !');
        }

        function displayNews() {
            const container = document.getElementById('newsContainer');
            
            if (news.length === 0) {
                container.innerHTML = `
                    <div class="no-content">
                        <p>Aucune news pour le moment.<br>Restez connectés pour les dernières actualités !</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = news.map(item => `
                <div class="news-item">
                    <div class="news-date">${new Date(item.date).toLocaleDateString('fr-FR')} à ${new Date(item.date).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</div>
                    <div class="news-title">${item.title}</div>
                    <div class="news-content">${item.content}</div>
                    ${isAdmin ? `
                        <div class="admin-controls">
                            <button class="btn btn-danger" onclick="removeNews(${item.id})">🗑️ Supprimer</button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function removeNews(newsId) {
            if (!isAdmin) return;
            
            if (confirm('Êtes-vous sûr de vouloir supprimer cette news ?')) {
                news = news.filter(n => n.id !== newsId);
                saveNews();
                displayNews();
                updateStats();
                updateAdminLists();
            }
        }

        function clearNews() {
            if (!isAdmin) return;
            
            if (confirm('Êtes-vous sûr de vouloir supprimer toutes les news ?')) {
                news = [];
                saveNews();
                displayNews();
                updateStats();
                updateAdminLists();
            }
        }

        // Sauvegarde et chargement des données
        function saveEvents() {
            // Utilise la mémoire temporaire, pas de localStorage
            console.log('Events sauvegardés en mémoire');
        }

        function saveNews() {
            // Utilise la mémoire temporaire, pas de localStorage  
            console.log('News sauvegardées en mémoire');
        }

        function loadStoredData() {
            // Pas de chargement depuis localStorage
            console.log('Pas de données persistantes, utilisation de la mémoire');
        }

        function updateStats() {
            document.getElementById('eventCount').textContent = events.length;
            document.getElementById('newsCount').textContent = news.length;
        }

        // Fonction pour mettre à jour les listes d'administration
        function updateAdminLists() {
            if (!isAdmin) return;
            
            updateAdminEventsList();
            updateAdminNewsList();
        }

        function updateAdminEventsList() {
            const container = document.getElementById('adminEventsList');
            
            if (events.length === 0) {
                container.innerHTML = '<div class="no-items">Aucun événement créé</div>';
                return;
            }

            container.innerHTML = events.map(event => {
                let statusText = '';
                switch(event.status) {
                    case 'ongoing': statusText = '🟢 En cours'; break;
                    case 'finished': statusText = '🔴 Terminé'; break;
                    default: statusText = '🟡 À venir';
                }

                return `
                    <div class="admin-item">
                        <div class="admin-item-content">
                            <div class="admin-item-title">${event.title}</div>
                            <div class="admin-item-meta">
                                ${statusText} • ${new Date(event.date).toLocaleDateString('fr-FR')} à ${new Date(event.date).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}
                            </div>
                            <div class="admin-item-desc">${event.description}</div>
                        </div>
                        <div class="admin-item-actions">
                            <button class="btn btn-danger btn-small" onclick="removeEventFromAdmin(${event.id})">🗑️ Supprimer</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateAdminNewsList() {
            const container = document.getElementById('adminNewsList');
            
            if (news.length === 0) {
                container.innerHTML = '<div class="no-items">Aucune news publiée</div>';
                return;
            }

            container.innerHTML = news.map(item => `
                <div class="admin-item">
                    <div class="admin-item-content">
                        <div class="admin-item-title">${item.title}</div>
                        <div class="admin-item-meta">
                            📅 ${new Date(item.date).toLocaleDateString('fr-FR')} à ${new Date(item.date).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}
                        </div>
                        <div class="admin-item-desc">${item.content.substring(0, 100)}${item.content.length > 100 ? '...' : ''}</div>
                    </div>
                    <div class="admin-item-actions">
                        <button class="btn btn-danger btn-small" onclick="removeNewsFromAdmin(${item.id})">🗑️ Supprimer</button>
                    </div>
                </div>
            `).join('');
        }

        // Fonctions de suppression depuis l'admin
        function removeEventFromAdmin(eventId) {
            if (!isAdmin) return;
            
            const event = events.find(e => e.id === eventId);
            if (event && confirm(`Êtes-vous sûr de vouloir supprimer l'événement "${event.title}" ?`)) {
                removeEvent(eventId);
            }
        }

        function removeNewsFromAdmin(newsId) {
            if (!isAdmin) return;
            
            const newsItem = news.find(n => n.id === newsId);
            if (newsItem && confirm(`Êtes-vous sûr de vouloir supprimer la news "${newsItem.title}" ?`)) {
                removeNews(newsId);
            }
        }

        function joinDiscord() {
            // Remplacez par votre vrai lien d'invitation Discord
            window.open('https://discord.gg/xZkWdaqV', '_blank');
        }

        // Vérifier les événements en cours au chargement
        function checkOngoingEvents() {
            events.forEach(event => {
                if (event.status === 'ongoing') {
                    const now = new Date();
                    const timeLeft = event.endTime - now;
                    
                    if (timeLeft > 0) {
                        startEventTimer(event);
                    } else {
                        // Marquer comme terminé
                        event.status = 'finished';
                        saveEvents();
                    }
                }
            });
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier le support des notifications
            if (checkNotificationSupport()) {
                notificationPermission = Notification.permission;
                
                // Vérifier si l'utilisateur a déjà été sollicité dans cette session
                const wasRequested = sessionStorage.getItem('notificationRequested');
                if (wasRequested === 'true') {
                    notificationRequested = true;
                }
                
                // Afficher le banner seulement si conditions remplies
                if (notificationPermission === 'default' && !notificationRequested) {
                    setTimeout(showNotificationBanner, 3000); // Délai de 3 secondes
                }
            }

            loadStoredData();
            displayEvents();
            displayNews();
            updateStats();
            checkOngoingEvents();
            
            // Stats simulées
            document.getElementById('memberCount').textContent = '64';
            document.getElementById('onlineCount').textContent = '14';

            // Fermer la sidebar si on clique ailleurs (mobile)
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const toggleButton = document.querySelector('.mobile-toggle');
                
                if (!sidebar.contains(event.target) && event.target !== toggleButton) {
                    closeSidebar();
                }
            });

            // Définir la date/heure par défaut dans le formulaire
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('eventDateTime').value = now.toISOString().slice(0,16);
        });
    </script>
</body>
</html>
